import{u as T,j as e,L as b}from"./index-BGj3ccG0.js";import{r as C,e as U,B as H,C as W,X as $,Y as J,T as z,L as Y,f as I,g as R,h as X}from"./recharts-D6sLb6Nn.js";import{C as f,a as h,b as u,c as g}from"./card-BiC0Y-bv.js";import{g as G,a as O}from"./firestore-CWn7XY5I.js";import{u as V}from"./use-data-fetching-CnxfQIi2.js";import"./lucide-1LV0pfLj.js";import"./firebase-DJ2aAbxa.js";const N=new Date().getFullYear(),w=new Date().getMonth()+1,a=o=>{const p=parseFloat(o);return isNaN(p)?0:p},m=o=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),q=o=>Math.abs(o)>=1e6?`KES ${(o/1e6).toFixed(1)}M`:Math.abs(o)>=1e3?`KES ${(o/1e3).toFixed(0)}K`:`KES ${o.toFixed(0)}`;function re(){const o=T(),p=C.useCallback(async()=>{const[t,c]=await Promise.all([G(),O(w,N)]),x=new Map(c.map(d=>[d.siteId,d]));return t.map(d=>{const i=x.get(d.id);return{...d,monthlyData:i?{...i,gridConsumption:a(i.gridConsumption),fuelConsumption:a(i.fuelConsumption),solarContribution:a(i.solarContribution),earningsSafaricom:a(i.earningsSafaricom),earningsAirtel:a(i.earningsAirtel),earningsJtl:a(i.earningsJtl),gridUnitCost:a(i.gridUnitCost),fuelUnitCost:a(i.fuelUnitCost),solarMaintenanceCost:a(i.solarMaintenanceCost)}:null}})},[]),{data:l,loading:L,error:y}=V(p),s=C.useCallback((t,c)=>t.monthlyData?a(t.monthlyData[c]):0,[]),v=C.useMemo(()=>{if(!l||!l.length)return null;const t=l.reduce((n,r)=>n+s(r,"earningsSafaricom")+s(r,"earningsAirtel")+s(r,"earningsJtl"),0),c=l.reduce((n,r)=>{const j=s(r,"gridConsumption")*s(r,"gridUnitCost"),A=s(r,"fuelConsumption")*s(r,"fuelUnitCost"),B=s(r,"solarMaintenanceCost");return n+j+A+B},0),x=t-c,d={safaricom:l.reduce((n,r)=>n+s(r,"earningsSafaricom"),0),airtel:l.reduce((n,r)=>n+s(r,"earningsAirtel"),0),jtl:l.reduce((n,r)=>n+s(r,"earningsJtl"),0)},i=[{name:"Safaricom",earnings:d.safaricom,color:"hsl(142, 70%, 50%)"},{name:"Airtel",earnings:d.airtel,color:"hsl(210, 70%, 50%)"},{name:"JTL",earnings:d.jtl,color:"hsl(45, 70%, 50%)"}].filter(n=>n.earnings>0),D=l.map(n=>{const r=s(n,"earningsSafaricom")+s(n,"earningsAirtel")+s(n,"earningsJtl"),j=s(n,"gridConsumption")*s(n,"gridUnitCost")+s(n,"fuelConsumption")*s(n,"fuelUnitCost")+s(n,"solarMaintenanceCost");return{name:n.name,profit:a(r)-a(j)}}).sort((n,r)=>a(r.profit)-a(n.profit));return{totalEarnings:a(t),totalExpenses:a(c),netProfit:a(x),tenantData:i,mostProfitableSites:D.slice(0,5),leastProfitableSites:D.slice(-5).reverse()}},[l,s]);if(L)return e.jsxs("p",{children:["Loading dashboard for ",new Date(0,w-1).toLocaleString("default",{month:"long"})," ",N,"..."]});if(y)return e.jsx("p",{className:"text-destructive",children:y});if(!v)return e.jsx("p",{children:"No data available for the current period."});const{totalEarnings:M,totalExpenses:E,netProfit:k,tenantData:S,mostProfitableSites:P,leastProfitableSites:F}=v,K=(t,c)=>{const x=t.name;o(`/sites?tenant=${x}`)};return e.jsxs("div",{className:"flex-1 space-y-4 p-4 md:p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:["Showing data for ",new Date(0,w-1).toLocaleString("default",{month:"long"})," ",N]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(b,{to:"/revenue-breakdown",children:e.jsxs(f,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-4 w-4 text-muted-foreground",children:e.jsx("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:m(M)})})]})}),e.jsx(b,{to:"/sites",children:e.jsxs(f,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Expenses"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-4 w-4 text-muted-foreground",children:e.jsx("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-red-500",children:m(E)})})]})}),e.jsx(b,{to:"/sites",children:e.jsxs(f,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Net Profit"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-4 w-4 text-muted-foreground",children:e.jsx("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})})]}),e.jsx(g,{children:e.jsx("div",{className:`text-2xl font-bold ${k>=0?"text-green-600":"text-red-600"}`,children:m(k)})})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(f,{className:"col-span-4",children:[e.jsx(h,{children:e.jsx(u,{children:"Earnings by Tenant"})}),e.jsx(g,{className:"pl-2",children:e.jsx(U,{width:"100%",height:350,children:e.jsxs(H,{data:S,margin:{top:20,right:30,left:60,bottom:5},children:[e.jsx(W,{strokeDasharray:"3 3",vertical:!1,strokeOpacity:.3}),e.jsx($,{dataKey:"name",tickLine:!1,axisLine:!1}),e.jsx(J,{label:{value:"Earnings (KES)",angle:-90,position:"insideLeft",style:{textAnchor:"middle",fontSize:"14px",fontWeight:"bold"}},tickFormatter:q,axisLine:!1,tickLine:!1,width:100,tick:{fill:"hsl(var(--foreground))",fontSize:"12px",fontWeight:"bold"}}),e.jsx(z,{formatter:t=>m(t)}),e.jsx(Y,{}),e.jsxs(I,{dataKey:"earnings",radius:[4,4,0,0],animationBegin:0,animationDuration:800,barSize:60,stroke:"hsl(var(--card-foreground))",strokeWidth:1,onClick:K,children:[" ",S.map((t,c)=>e.jsx(R,{fill:t.color},`cell-${c}`)),e.jsx(X,{dataKey:"earnings",position:"top",formatter:t=>m(t),fill:"hsl(var(--foreground))",fontSize:12,fontWeight:"bold"})]})]})})})]}),e.jsxs(f,{className:"col-span-3",children:[e.jsx(h,{children:e.jsx(u,{children:"Site Profitability"})}),e.jsxs(g,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold mb-2 text-green-600",children:"Most Profitable"}),e.jsx("ul",{className:"space-y-2 text-sm",children:P.map(t=>e.jsxs("li",{className:"flex justify-between items-center py-1 border-b border-border last:border-b-0",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsx("span",{className:"font-mono text-green-600 font-bold",children:m(t.profit)})]},t.name))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2 text-red-600",children:"Least Profitable"}),e.jsx("ul",{className:"space-y-2 text-sm",children:F.map(t=>e.jsxs("li",{className:"flex justify-between items-center py-1 border-b border-border last:border-b-0",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsx("span",{className:`font-mono font-bold ${t.profit>=0?"text-green-600":"text-red-600"}`,children:m(t.profit)})]},t.name))})]})]})]})]})]})}export{re as default};
