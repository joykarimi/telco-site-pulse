import{a as F,b as k,g as A,c as E,d as t,j as e,N as L,B as v,e as q}from"./index-BGj3ccG0.js";import{r as n}from"./recharts-D6sLb6Nn.js";import{I as c}from"./input-YaoJJbld.js";import{L as m}from"./label-BzcwPuvC.js";import{B as R}from"./tower-DH_myvJ9.js";import{k as p}from"./lucide-1LV0pfLj.js";import"./firebase-DJ2aAbxa.js";function H(){const[a,d]=n.useState(!1),[g,h]=n.useState("email"),[l,w]=n.useState({email:"",password:""}),[o,x]=n.useState({password:"",confirmPassword:""}),[f]=F(),j=f.get("mode"),i=f.get("oobCode"),{user:y,login:N,loading:b}=k(),u=A();if(n.useEffect(()=>{j==="resetPassword"&&i&&E(u,i).then(()=>{h("resetPassword")}).catch(s=>{t.error("Invalid or expired password reset link.",{description:"Please request a new password reset link if needed."}),console.error("Invalid oobCode:",s)})},[j,i,u]),b)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-primary"})});if(y)return e.jsx(L,{to:"/",replace:!0});const P=async s=>{s.preventDefault(),d(!0);try{await N(l.email,l.password),t.success("Signed in successfully!")}catch(r){const C=r.code==="auth/invalid-credential"?"Invalid email or password. Please try again.":"An unexpected error occurred. Please try again.";t.error(C)}finally{d(!1)}},S=async s=>{if(s.preventDefault(),o.password!==o.confirmPassword){t.error("Passwords do not match.");return}if(!i){t.error("Missing action code. Please use the link from your email.");return}d(!0);try{await q(u,i,o.password),t.success("Password has been reset successfully!",{description:"You can now sign in with your new password."}),h("email")}catch(r){t.error("Failed to reset password.",{description:"The link may have expired. Please try resetting your password again."}),console.error("Password Reset Error:",r)}finally{d(!1)}},I=()=>g==="resetPassword"?e.jsxs("form",{onSubmit:S,className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Set Your New Password"}),e.jsx("p",{className:"text-balance text-muted-foreground",children:"Please enter and confirm your new password below."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"reset-password",children:"New Password"}),e.jsx(c,{id:"reset-password",type:"password",value:o.password,onChange:s=>x(r=>({...r,password:s.target.value})),required:!0,disabled:a})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"reset-confirm-password",children:"Confirm New Password"}),e.jsx(c,{id:"reset-confirm-password",type:"password",value:o.confirmPassword,onChange:s=>x(r=>({...r,confirmPassword:s.target.value})),required:!0,disabled:a})]}),e.jsx(v,{type:"submit",className:"w-full",disabled:a,children:a?e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}):"Set New Password"})]}):e.jsxs("form",{onSubmit:P,className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"signin-email",children:"Email"}),e.jsx(c,{id:"signin-email",type:"email",placeholder:"admin@example.com",value:l.email,onChange:s=>w(r=>({...r,email:s.target.value})),required:!0,disabled:a})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"signin-password",children:"Password"}),e.jsx(c,{id:"signin-password",type:"password",value:l.password,onChange:s=>w(r=>({...r,password:s.target.value})),required:!0,disabled:a})]}),e.jsx(v,{type:"submit",className:"w-full",disabled:a,children:a?e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}):"Sign In"})]});return e.jsxs("div",{className:"w-full lg:grid lg:min-h-screen lg:grid-cols-2",children:[e.jsxs("div",{className:"hidden bg-muted lg:flex lg:flex-col items-center justify-center p-8 border-r",children:[e.jsx("p",{className:"text-center text-lg mt-4 max-w-md",children:"Your centralized hub for managing telecommunication sites, assets, and profitability with precision and foresight."}),e.jsx("img",{src:R,alt:"Telecommunication Tower",className:"mt-8 rounded-md aspect-video object-cover"}),e.jsxs("div",{className:"mt-auto text-sm text-muted-foreground",children:["Â© ",new Date().getFullYear()," Alan Dick & Company. All rights reserved."]})]}),e.jsx("div",{className:"flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto grid w-[380px] gap-6",children:[e.jsxs("div",{className:"grid gap-4 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sign In"}),g!=="resetPassword"&&e.jsx("p",{className:"text-balance text-muted-foreground",children:"Enter your email and password below to access your dashboard."})]}),I()]})})]})}export{H as default};
