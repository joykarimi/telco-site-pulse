import{i as E,j as e,m as i,B as h,L,A as S,o as _,R as F,k as p,n as g}from"./index-BGj3ccG0.js";import{r as n}from"./recharts-D6sLb6Nn.js";import{C as O,a as k,b as M,d as B,c as H}from"./card-BiC0Y-bv.js";import{T as V,a as z,b as I,c as l,d as c}from"./table-DvF6-9ey.js";import{B as P}from"./badge-BzW7j6N6.js";import{A as W,a as q,b as G,c as J,d as Y,e as $,f as K,g as Q,h as X}from"./alert-dialog-DYLDXeiv.js";import{U as v,m as Z,k as b,n as U,o as ee,W as se,p as ae,q as te,r as re}from"./lucide-1LV0pfLj.js";import"./firebase-DJ2aAbxa.js";const x={admin:"Administrator",operations_manager:"Operations Manager",maintenance_manager:"Maintenance Manager",user:"User",viewer:"Viewer"},ie={admin:te,operations_manager:ae,maintenance_manager:se,user:ee,viewer:U},ne={admin:"destructive",operations_manager:"primary",maintenance_manager:"secondary",user:"default",viewer:"default"},le=p(g,"listUsers"),ce=p(g,"manageUserRole"),oe=p(g,"deleteUser");function fe(){const[j,o]=n.useState([]),[w,u]=n.useState(!0),[C,f]=n.useState(null),{toast:r}=E(),A=async()=>{u(!0);try{const a=(await le()).data.users;o(a)}catch(s){console.error("Error fetching users:",s),r({title:"Error Fetching Users",description:s.message,variant:"destructive"})}finally{u(!1)}};n.useEffect(()=>{A()},[]);const D=async(s,a)=>{f(s);try{await ce({userId:s,role:a}),o(t=>t.map(m=>m.uid===s?{...m,role:a}:m)),r({title:"Role Updated",description:`User role changed to ${x[a]}.`,variant:"success"})}catch(t){r({title:"Update Failed",description:t.message,variant:"destructive"})}finally{f(null)}},T=async s=>{try{await oe({userId:s}),o(a=>a.filter(t=>t.uid!==s)),r({title:"User Deleted",description:"The user has been permanently deleted.",variant:"success"})}catch(a){r({title:"Deletion Failed",description:a.message,variant:"destructive"})}},R=s=>{const a=s.split(" ").filter(Boolean);return a.length===0?"":a.length===1?a[0][0].toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()},N=n.useMemo(()=>[...j].sort((s,a)=>new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime()),[j]),y={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.05}}},d={hidden:{y:20,opacity:0},show:{y:0,opacity:1}};return e.jsx(i.div,{initial:"hidden",animate:"show",variants:y,className:"space-y-6",children:e.jsxs(O,{className:"overflow-hidden shadow-xl border-primary/10 rounded-2xl",children:[e.jsx(k,{className:"bg-muted/20 border-b border-primary/10",children:e.jsxs(i.div,{variants:d,className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(M,{className:"flex items-center gap-3 text-2xl font-bold tracking-tight",children:[e.jsx(v,{className:"h-7 w-7 text-primary"}),"User & Role Management"]}),e.jsx(B,{className:"mt-2",children:"View, manage, and assign user roles across the platform."})]}),e.jsx(h,{asChild:!0,children:e.jsxs(L,{to:"/users/create",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Create User"]})})]})}),e.jsx(H,{className:"p-0",children:w?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(b,{className:"h-10 w-10 animate-spin text-primary"})}):N.length===0?e.jsxs(i.div,{variants:d,className:"text-center p-12",children:[e.jsx(v,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:"No Users Found"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Start by creating a new user to see them here."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(V,{children:[e.jsx(z,{children:e.jsxs(I,{children:[e.jsx(l,{className:"w-[30%]",children:"User"}),e.jsx(l,{children:"Role"}),e.jsx(l,{children:"Date Joined"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(i.tbody,{initial:"hidden",animate:"show",variants:y,children:N.map(s=>{const a=ie[s.role]||U;return e.jsxs(i.tr,{variants:d,className:"border-b border-primary/5 hover:bg-muted/50",children:[e.jsx(c,{className:"font-medium py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(S,{className:"h-10 w-10 border-2 border-primary/10",children:e.jsx(_,{className:"bg-muted font-bold",children:R(s.displayName)})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:s.displayName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx(c,{children:e.jsxs(P,{variant:ne[s.role],className:"flex items-center gap-1.5 w-fit capitalize text-sm py-1 px-3 rounded-full",children:[e.jsx(a,{className:"h-4 w-4"}),x[s.role]]})}),e.jsx(c,{className:"text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(c,{className:"text-right",children:C===s.uid?e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{className:"h-6 w-6 animate-spin text-primary"})}):e.jsxs("div",{className:"flex justify-end items-center gap-2",children:[Object.values(F).map(t=>e.jsx(h,{variant:s.role===t?"default":"ghost",size:"sm",onClick:()=>D(s.uid,t),disabled:s.role===t,children:x[t]},t)),e.jsxs(W,{children:[e.jsx(q,{asChild:!0,children:e.jsx(h,{variant:"destructive",size:"icon",className:"ml-2",children:e.jsx(re,{className:"h-4 w-4"})})}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:"Confirm User Deletion"}),e.jsxs($,{children:["Are you sure you want to permanently delete ",s.displayName,"? This action cannot be undone."]})]}),e.jsxs(K,{children:[e.jsx(Q,{children:"Cancel"}),e.jsx(X,{onClick:()=>T(s.uid),children:"Delete User"})]})]})]})]})})]},s.uid)})})]})})})]})})}export{fe as default};
